<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Uzay Savaşı - Retro Arcade</title>
    <style>
        body { 
            margin: 0; 
            background: #0a0a0a; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            color: white; 
            font-family: 'Courier New', monospace;
            overflow: hidden;
            touch-action: none;
        }
        #game-container { 
            position: relative; 
            width: 100vw;
            height: 100vh;
        }
        canvas { 
            background: #000510; 
            display: block;
            width: 100%;
            height: 100%;
            touch-action: none;
        }
        #ui { 
            position: absolute; 
            top: env(safe-area-inset-top, 10px); 
            left: 10px; 
            right: 10px;
            pointer-events: none; 
            font-size: 14px; 
            color: #0f0;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.3);
            padding: 5px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="ui">
            <div>SKOR: <span id="score">0</span> | CAN: <span id="lives">3</span></div>
            <div>DALGA: <span id="wave">1</span> | GÜÇ: <span id="power">1</span></div>
        </div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let score = 0; 
        let lives = 3; 
        let wave = 1; 
        let gameOver = false;
        let powerLevel = 1;
        let powerUpTimer = 0;
        let boss = null;
        let bossWarningShown = false;
        let isTouching = false;
        let showChapterMessage = false;
        let chapterMessageTimer = 0;
        let currentChapter = 1;
        
        const player = { x: 0, y: 0, w: 40, h: 45, speed: 6 };
        let bullets = []; 
        let enemies = []; 
        let enemyBullets = [];
        let shields = [];
        let floatingPowerUps = [];
        let shootCooldown = 0;
        let enemyShootTimer = 0;

        // EKRAN BOYUTLANDIRMA (SABİT ORAN YERİNE TAM EKRAN)
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            // Oyuncuyu zemine yerleştir
            player.x = canvas.width / 2 - 20;
            player.y = canvas.height - 100;
            
            // Kalkanları ekran genişliğine göre yeniden dağıt
            createShields();
        }

        // --- SENİN ORİJİNAL GRAFİK FONKSİYONLARIN (AYNEN KORUNDU) ---
        function drawPlayer(x, y) {
            ctx.fillStyle = Math.random() > 0.5 ? '#ff4500' : '#ff8c00';
            ctx.fillRect(x + 15, y + 35, 10, 10);
            ctx.fillStyle = '#900';
            ctx.fillRect(x, y + 20, 40, 10);
            ctx.fillStyle = powerLevel === 3 ? '#ff00ff' : powerLevel === 2 ? '#ff6600' : '#ff0000';
            ctx.fillRect(x + 12, y, 16, 40);
            ctx.fillStyle = '#87ceeb';
            ctx.fillRect(x + 15, y + 10, 10, 8);
        }

        function drawEnemy(x, y) {
            ctx.fillStyle = '#00ffff';
            ctx.fillRect(x + 10, y, 10, 5);
            ctx.fillStyle = '#0055ff';
            ctx.fillRect(x, y + 5, 30, 15);
            ctx.fillStyle = '#fff';
            ctx.fillRect(x + 5, y + 10, 4, 4);
            ctx.fillRect(x + 21, y + 10, 4, 4);
        }

        function drawBoss(boss) {
            const x = boss.x, y = boss.y, w = boss.w, h = boss.h;
            ctx.shadowBlur = 20; ctx.shadowColor = '#ff0000';
            ctx.fillStyle = '#8800ff';
            ctx.fillRect(x, y + h * 0.2, w, h * 0.6);
            ctx.fillStyle = '#6600cc';
            ctx.fillRect(x - w * 0.3, y + h * 0.3, w * 0.3, h * 0.4);
            ctx.fillRect(x + w, y + h * 0.3, w * 0.3, h * 0.4);
            ctx.fillStyle = '#aa00ff';
            ctx.fillRect(x + w * 0.3, y, w * 0.4, h * 0.3);
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(x + w * 0.35, y + h * 0.1, w * 0.1, h * 0.1);
            ctx.fillRect(x + w * 0.55, y + h * 0.1, w * 0.1, h * 0.1);
            ctx.fillStyle = Math.random() > 0.5 ? '#ff4500' : '#ff8c00';
            ctx.fillRect(x + w * 0.2, y + h * 0.85, w * 0.2, h * 0.15);
            ctx.fillRect(x + w * 0.6, y + h * 0.85, w * 0.2, h * 0.15);
            ctx.shadowBlur = 0;
            const healthPercent = boss.health / boss.maxHealth;
            ctx.fillStyle = '#333'; ctx.fillRect(x, y - 20, w, 8);
            ctx.fillStyle = healthPercent > 0.5 ? '#0f0' : healthPercent > 0.25 ? '#ff0' : '#f00';
            ctx.fillRect(x, y - 20, w * healthPercent, 8);
        }

        function createShields() {
            shields = [];
            const shieldY = canvas.height - 180;
            const spacing = canvas.width / 4;
            for (let i = 0; i < 3; i++) {
                const shieldX = spacing * (i + 1) - 30;
                const blocks = [];
                for (let row = 0; row < 10; row++) {
                    blocks[row] = [];
                    for (let col = 0; col < 15; col++) blocks[row][col] = 1;
                }
                shields.push({ x: shieldX, y: shieldY, w: 60, h: 40, blockSize: 4, blocks: blocks, cols: 15, rows: 10 });
            }
        }
        // --- GRAFİK FONKSİYONLARI SONU ---

        // MOBİL KONTROL (TOUCH)
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            player.x = (touch.clientX - rect.left) - player.w / 2;
            player.y = (touch.clientY - rect.top) - player.h / 2;
            
            // Sınırlar
            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width - player.w) player.x = canvas.width - player.w;
            if (player.y < canvas.height * 0.3) player.y = canvas.height * 0.3;
            if (player.y > canvas.height - player.h) player.y = canvas.height - player.h;
        }, { passive: false });

        function spawnEnemies() {
            const enemyCount = 3 + Math.floor(wave / 2);
            for (let i = 0; i < enemyCount; i++) {
                enemies.push({
                    x: Math.random() * (canvas.width - 30), y: -50 - (i * 100),
                    w: 30, h: 25, centerX: Math.random() * (canvas.width - 60) + 30,
                    offset: Math.random() * 10, speed: 1.5 + (wave * 0.1), canShoot: Math.random() > 0.6
                });
            }
        }

        function update() {
            if (gameOver) return;
            if (shootCooldown <= 0) {
                bullets.push({ x: player.x + player.w/2 - 2, y: player.y, w: 4, h: 12, damage: 1 });
                shootCooldown = 15;
            }
            if (shootCooldown > 0) shootCooldown--;

            bullets.forEach((b, i) => {
                b.y -= 8;
                if (b.y < 0) bullets.splice(i, 1);
            });

            enemies.forEach((e, i) => {
                e.y += e.speed;
                e.x = e.centerX + Math.sin(e.y / 50) * 30;
                if (e.y > canvas.height) enemies.splice(i, 1);
            });

            if (enemies.length === 0) { wave++; spawnEnemies(); document.getElementById('wave').innerText = wave; }
        }

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            shields.forEach(s => {
                for(let r=0; r<s.rows; r++) {
                    for(let c=0; c<s.cols; c++) {
                        if(s.blocks[r][c]) {
                            ctx.fillStyle = "#0f0";
                            ctx.fillRect(s.x + c*s.blockSize, s.y + r*s.blockSize, 3, 3);
                        }
                    }
                }
            });
            drawPlayer(player.x, player.y);
            enemies.forEach(e => drawEnemy(e.x, e.y));
            ctx.fillStyle = '#ff0';
            bullets.forEach(b => ctx.fillRect(b.x, b.y, b.w, b.h));
            update();
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        spawnEnemies();
        animate();
    </script>
</body>
</html>
