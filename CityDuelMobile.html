<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<meta name="viewport"
content="width=device-width,
initial-scale=1,
maximum-scale=1,
user-scalable=no,
viewport-fit=cover">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="City Duel">

<title>City Duel</title>

<style>
html,body{
    margin:0;
    padding:0;
    background:#000814;
    overflow:hidden;
    font-family:Verdana,sans-serif;
}

/* ROTATE MESSAGE */
#rotateMessage{
    position:fixed;
    inset:0;
    background:#000814;
    color:white;
    display:flex;
    justify-content:center;
    align-items:center;
    text-align:center;
    font-size:22px;
    z-index:1000;
}

/* GAME AREA */
#gameWrapper{
    position:absolute;
    inset:0;
    display:flex;
    justify-content:center;
    align-items:center;
}

canvas{
    background:#001d3d;
    image-rendering:pixelated;
}

/* HUD */
#topUI{
    position:absolute;
    top:5px;
    width:100%;
    text-align:center;
    pointer-events:none;
    color:white;
}

.hud{
    position:absolute;
    top:5px;
    font-weight:bold;
    font-size:16px;
}

#p1hud{ left:10px; color:lime; }
#p2hud{ right:10px; color:red; }

#controls{
    position:absolute;
    bottom:5px;
    width:100%;
    text-align:center;
    color:white;
}

input[type=range]{ width:140px; }
button{ padding:6px 12px; }
</style>
</head>
<body>

<div id="rotateMessage">
ðŸ“±<br><br>LÃ¼tfen telefonu yatay Ã§evir
</div>

<div id="topUI">
<div id="p1hud" class="hud"></div>
<div id="p2hud" class="hud"></div>
<div id="windDisplay"></div>
</div>

<div id="gameWrapper">
<canvas id="game"></canvas>
</div>

<div id="controls">
AÃ§Ä± <span id="angleValue">45</span>
<input type="range" id="angle" min="0" max="90" value="45">
&nbsp;
GÃ¼Ã§ <span id="powerValue">50</span>
<input type="range" id="power" min="10" max="100" value="50">
<button onclick="shoot()">ATEÅž</button>
</div>

<script>
const baseWidth=1000;
const baseHeight=500;

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

let buildings=[],stars=[];
let projectile=null;
let gravity=0.35;
let wind=0;
let currentPlayer=1;
let hits={1:0,2:0};
let maxHits=5;
let player1,player2;

/* ROTATION CHECK */
function checkOrientation(){
    if(window.innerHeight>window.innerWidth){
        rotateMessage.style.display="flex";
    }else{
        rotateMessage.style.display="none";
    }
}
window.addEventListener("resize",checkOrientation);
checkOrientation();

/* SCALE */
function resizeCanvas(){
    let scale=Math.min(window.innerWidth/baseWidth,
                       window.innerHeight/baseHeight);
    canvas.width=baseWidth;
    canvas.height=baseHeight;
    canvas.style.width=(baseWidth*scale)+"px";
    canvas.style.height=(baseHeight*scale)+"px";
}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

/* SLIDERS */
angle.oninput=()=>angleValue.innerText=angle.value;
power.oninput=()=>powerValue.innerText=power.value;

/* STARS */
function generateStars(){
    stars=[];
    for(let i=0;i<120;i++){
        stars.push({
            x:Math.random()*baseWidth,
            y:Math.random()*baseHeight,
            size:Math.random()*2
        });
    }
}
function drawStars(){
    ctx.fillStyle="white";
    for(let s of stars){
        ctx.fillRect(s.x,s.y,s.size,s.size);
    }
}

/* CITY */
function generateCity(){
    buildings=[];
    let x=0;
    while(x<baseWidth){
        let width=80+Math.random()*40;
        let height=200+Math.random()*150;
        if(x+width>baseWidth) width=baseWidth-x;
        buildings.push({x,width,height});
        x+=width;
    }
    player1={x:buildings[0].x+buildings[0].width/2,
             y:baseHeight-buildings[0].height,
             color:"lime"};
    player2={x:buildings[buildings.length-1].x+
             buildings[buildings.length-1].width/2,
             y:baseHeight-buildings[buildings.length-1].height,
             color:"red"};
}

function drawCity(){
    ctx.fillStyle="#444";
    for(let b of buildings){
        ctx.fillRect(b.x,baseHeight-b.height,b.width,b.height);
    }
}

function drawPlayer(p,label){
    ctx.fillStyle=p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y-20,10,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle="white";
    ctx.fillText(label,p.x,p.y-35);
}

function updateHUD(){
    p1hud.innerText="P1 â¤ï¸ "+(maxHits-hits[1]);
    p2hud.innerText="P2 â¤ï¸ "+(maxHits-hits[2]);
}

/* WIND */
function newWind(){
    wind=Math.random()*0.6-0.3;
    windDisplay.innerText="RÃ¼zgar: "+wind.toFixed(2);
}

/* SHOOT */
function shoot(){
    if(projectile) return;

    let angleRad=angle.value*Math.PI/180;
    let speed=power.value/5;

    let shooter=currentPlayer===1?player1:player2;
    let dir=currentPlayer===1?1:-1;

    projectile={
        x:shooter.x,
        y:shooter.y-20,
        vx:Math.cos(angleRad)*speed*dir,
        vy:-Math.sin(angleRad)*speed
    };
}

/* LOOP */
function update(){
    ctx.clearRect(0,0,baseWidth,baseHeight);

    drawStars();
    drawCity();
    drawPlayer(player1,"P1");
    drawPlayer(player2,"P2");

    if(projectile){
        projectile.vy+=gravity;
        projectile.vx+=wind;
        projectile.x+=projectile.vx;
        projectile.y+=projectile.vy;

        ctx.fillStyle="yellow";
        ctx.beginPath();
        ctx.arc(projectile.x,projectile.y,5,0,Math.PI*2);
        ctx.fill();

        if(projectile.y>baseHeight){
            projectile=null;
            currentPlayer=currentPlayer===1?2:1;
            newWind();
        }
    }

    requestAnimationFrame(update);
}

generateStars();
generateCity();
newWind();
updateHUD();
update();
</script>

</body>
</html>
